---
title: Pay
description: Process an agreement-based payment using a stored access token.
---

`POST /v1/payments/pay`

Initiates a payment using a previously authorized agreement (subscription payment). This endpoint is used for recurring payments where the user has already signed a payment agreement.

## Use Case

After a user signs a payment agreement via the authorization flow, you can charge them automatically without requiring interaction:

- Monthly subscriptions
- Recurring billing
- Scheduled payments
- Usage-based charges

## Request Parameters

<ParamField body="productCode" type="string" required>
  Payment product code assigned by Rebell.
</ParamField>

<ParamField body="paymentRequestId" type="string" required>
  Merchant-generated unique identifier (idempotency key).

  **Max length**: 64 characters
</ParamField>

<ParamField body="paymentAmount" type="object" required>
  Payment amount details.

  <Expandable title="properties">
    <ParamField body="currency" type="string" required>
      ISO-4217 currency code (e.g., `EUR`)
    </ParamField>
    <ParamField body="value" type="string" required>
      Amount in minor units
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="accessToken" type="string" required>
  Access token obtained from the authorization flow.

  **Max length**: 128 characters
</ParamField>

<ParamField body="order" type="object">
  Order details.

  <Expandable title="properties">
    <ParamField body="orderDescription" type="string">
      Description shown in user's transaction history
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="paymentNotifyUrl" type="string">
  Webhook URL for payment notifications.
</ParamField>

## Response Parameters

<ResponseField name="result" type="object" required>
  Standard result object
</ResponseField>

<ResponseField name="paymentId" type="string">
  Rebell payment identifier
</ResponseField>

<ResponseField name="paymentRequestId" type="string">
  Echo of merchant payment request ID
</ResponseField>

<ResponseField name="paymentTime" type="string">
  Payment completion time (ISO 8601)
</ResponseField>

<ResponseField name="paymentAmount" type="object">
  Confirmed payment amount
</ResponseField>

## Example Request

```json
{
  "productCode": "5105010010000100040",
  "paymentRequestId": "SUB-20240110-001",
  "paymentAmount": {
    "currency": "EUR",
    "value": "999"
  },
  "accessToken": "281010033AB2F588D14B43238637264FCA5AAF35xxxx",
  "order": {
    "orderDescription": "Premium subscription - January 2024"
  },
  "paymentNotifyUrl": "https://merchant.example.com/webhooks/payment"
}
```

## Example Response

```json
{
  "result": {
    "resultCode": "SUCCESS",
    "resultStatus": "S",
    "resultMessage": "success"
  },
  "paymentId": "2024011012345678901234",
  "paymentRequestId": "SUB-20240110-001",
  "paymentTime": "2024-01-10T00:01:00+01:00",
  "paymentAmount": {
    "currency": "EUR",
    "value": "999"
  }
}
```

## Result Codes

| resultStatus | resultCode | Description | Action |
|-------------|-----------|-------------|--------|
| `S` | `SUCCESS` | Payment successful | Update subscription status |
| `F` | `INVALID_ACCESS_TOKEN` | Token invalid or expired | Re-authorize user |
| `F` | `INSUFFICIENT_BALANCE` | User has insufficient funds | Notify user, retry later |
| `F` | `RISK_REJECT` | Rejected by risk system | Contact user |
| `F` | `USER_NOT_EXIST` | User not found | Check access token |
| `U` | `PAYMENT_IN_PROCESS` | Payment processing | Poll with inquiryPayment |

## Implementation Example

```javascript
class SubscriptionBilling {
  async processMonthlyBilling(subscription) {
    const paymentRequestId = `SUB-${subscription.id}-${Date.now()}`;

    try {
      // Ensure we have a valid access token
      const accessToken = await tokenManager.getValidAccessToken(
        subscription.userId
      );

      const response = await rebellAPI.pay({
        productCode: process.env.REBELL_PRODUCT_CODE,
        paymentRequestId,
        paymentAmount: {
          currency: 'EUR',
          value: String(subscription.priceInCents)
        },
        accessToken,
        order: {
          orderDescription: `${subscription.planName} - ${getCurrentMonth()}`
        },
        paymentNotifyUrl: `${process.env.BASE_URL}/webhooks/payment`
      });

      if (response.result.resultStatus === 'S') {
        await this.recordPayment(subscription.id, {
          paymentId: response.paymentId,
          amount: subscription.priceInCents,
          status: 'success'
        });
        return { success: true };
      }

      if (response.result.resultStatus === 'U') {
        // Payment processing - will be confirmed via webhook
        return { success: false, pending: true, paymentId: response.paymentId };
      }

      // Payment failed
      return {
        success: false,
        error: response.result.resultCode,
        message: response.result.resultMessage
      };

    } catch (error) {
      await this.recordPaymentFailure(subscription.id, error);
      throw error;
    }
  }
}
```

## Handling Payment Failures

When a subscription payment fails:

<Steps>
  <Step title="Identify Failure Reason">
    Check the `resultCode` to understand why the payment failed
  </Step>

  <Step title="Take Appropriate Action">
    - `INSUFFICIENT_BALANCE`: Notify user, schedule retry
    - `INVALID_ACCESS_TOKEN`: Prompt user to re-authorize
    - `RISK_REJECT`: Contact user, may need manual review
  </Step>

  <Step title="Retry Strategy">
    Implement a retry schedule (e.g., retry after 1, 3, 7 days)
  </Step>

  <Step title="Grace Period">
    Maintain service during grace period while retrying
  </Step>
</Steps>

## Related

<CardGroup cols={2}>
  <Card title="Apply Token" icon="key" href="/openapis/authorizations/applyToken">
    Get access tokens for agreement payments
  </Card>

  <Card title="Inquiry Payment" icon="magnifying-glass" href="/openapis/payments/inquiryPayment">
    Check payment status
  </Card>
</CardGroup>
